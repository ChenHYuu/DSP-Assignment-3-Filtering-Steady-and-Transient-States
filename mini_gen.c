#include <stdio.h>
#include <gsl/gsl_poly.h>
#include <math.h>
#include <complex.h>

#define ORDER_4
// #define ORDER_16
// #define ORDER_64

#ifdef ORDER_4
  #define ORDER 4
#endif
#ifdef ORDER_16
  #define ORDER 16
#endif
#ifdef ORDER_64
  #define ORDER 64
#endif

int main(void)
{
    int i;
    /* coefficients of P(x) = -1 + x^5 */
    #ifdef ORDER_4
    const char *filename = "coef4.txt";
    double a[ORDER + 1] = {0.285317971457912378241417172830551862717,-0.003523038633561165807600579213954006264, 0.002993865590892453524413108212343104242,-0.003523038633561134148897142637224533246, 0.285317971457912378241417172830551862717};
    #endif

    #ifdef ORDER_16
    const char *filename = "coef16.txt";
    double a[ORDER + 1] = {0.287800667601417592411650048234150744975, 0.002136979404369422717163695679687407392, 0.005964897857245232519474154031513535301, 0.001887802374788395253640826965124688286,-0.000412081718147683424575272725931540663, 0.004734980606722823635867936076238038368, 0.003762693348138725427109996246599621372, 0.007876035201337023422540895012389228214, 0.0028975240822735706149038126255845782  , 0.007876035201337278426891863603032106766, 0.003762693348138853362966349536122834252, 0.004734980606722863534507883542801209842,-0.000412081718147683424575272725931540663, 0.001887802374788427129184698038955048105, 0.005964897857245216039601132251846138388, 0.002136979404369390624779390108756160771, 0.287800667601417536900498816976323723793};
    #endif

    #ifdef ORDER_64
    const char *filename = "coef64.txt";
    double a[ORDER + 1] = {0.271426914542662711671283659597975201905, 0.011716376841243783535340128310053842142, 0.01181803279625859987023162034347478766 , 0.011391762654093529061327672025072388351, 0.013029079609979069692693443016651144717, 0.012151858122634711170673149638332688482, 0.013955515703264399773875226173913688399, 0.012971786252918017165458586248405481456, 0.013385401597085485117522019038460712181, 0.011692102993023322649035478093537676614, 0.01184544330979340337473004751700500492 , 0.014247217386163361224626910939150548074, 0.013305286269459513232016334427498804871, 0.013333278697628476311409784216266416479, 0.014286258786345880367196770066584576853, 0.013247616074618866893741753187896392774, 0.013400012510448255920181281908298842609, 0.012488096852155785784765917867389362073, 0.014621076933216346424582177121465065284, 0.014419717455561300786803791140755492961, 0.01502987433666677641319608937919838354 , 0.013619868442206415834472288395318173571, 0.014433221596210910053770248850923962891, 0.015009486942971538361857319898717832984, 0.013693926540122204268956629391595924972, 0.015607993568576655069035652445563755464, 0.014442083097443282266314490414060855983, 0.012463759168606397542689023794082459062, 0.01514698967071979353316013572339215898 , 0.01478329317126063184584250365105617675 , 0.013692469611473731538886511316377436742, 0.013542827391772883569021068694837595103, 0.014147856122269566320204248199843277689, 0.014890322557239729292510865832355193561, 0.015012783381352890269000432965640356997, 0.013974090581783704320684158517451578518, 0.013343959530975968777455342717530584196, 0.016227135442593736136540627512658829801, 0.014654302169517845200186201282122056   , 0.013271752140530895455738935595491057029, 0.015089918466352950088271711592824431136, 0.013792628805674932504499174967804719927, 0.014223377752641630164531783009351784131, 0.015173823461220609792876601318312168587, 0.013796516901919950170984918713656952605, 0.014265108185885749803034627802844624966, 0.013982887213509166343672340815373900114, 0.016455422336468530919439956505812006071, 0.016237570433412906040215872849330480676, 0.017069161827829963662406242974611814134, 0.016662680510290673457918231292751443107, 0.018371964092277700414390650962559448089, 0.019550897846330798218739133176313771401, 0.019813745330982721060131268586701480672, 0.024025590703382615487271323218010365963, 0.026980593410094167589052815969807852525, 0.028375564602949047282587358154160028789, 0.032288286402627215665450677306580473669, 0.035469010298975818529232384435090352781, 0.042569368198861978758174018366844393313, 0.048402488301105571488758272380437119864, 0.058447123649385812615975055450689978898, 0.068613069852533722925436165951396105811, 0.081639320104415172285605706292699323967,-0.221183172455363175057385660693398676813};
    #endif

    double z[ORDER * 2];
    double complex zeros;
    gsl_poly_complex_workspace *w = gsl_poly_complex_workspace_alloc(ORDER + 1);

    gsl_poly_complex_solve(a, ORDER + 1, w, z);

    gsl_poly_complex_workspace_free(w);

    FILE *fp = fopen(filename, "w");
    if (fp == NULL) {
        fprintf(stderr, "Cannot open file %s for writing.\n", filename);
        return 0;
    }
    for (i = 0; i < ORDER; i++) {
        zeros = z[2 * i] + z[2 * i + 1] * I;

        fprintf(fp, "z%d = %+.18f %+.18f (%+.18f/%+.18f)\n",
                i, z[2 * i], z[2 * i + 1],
                sqrt(z[2 * i] * z[2 * i] + z[2 * i + 1] * z[2 * i + 1]),
                sqrt(1.0 / (z[2 * i] * z[2 * i] + z[2 * i + 1] * z[2 * i + 1])));
    }
    fclose(fp);

    return 0;
}
